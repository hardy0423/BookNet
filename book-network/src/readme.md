


┌───────────────────────────────────────────┐
│                 Client                     │
│   (React, Angular, Mobile, Postman...)     │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│              API Gateway (HTTP)           │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│            Spring Security                 │
│-------------------------------------------│
│ Filters:                                   │
│   - JwtAuthFilter (custom)                 │
│   - UsernamePasswordAuthenticationFilter    │
│-------------------------------------------│
│ Authentication Provider                     │
│   - DaoAuthenticationProvider               │
│   - PasswordEncoder                         │
│-------------------------------------------│
│ Authorization (roles, permissions)         │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│                 Controllers                │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│               Services                     │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│               Repositories                 │
│         (UserRepository, ProductRepo…)     │
└───────────────────────────────────────────┘
|
v
┌───────────────────────────────────────────┐
│                Database                    │
│           (PostgreSQL / MySQL…)            │
└───────────────────────────────────────────┘


********************************************************************************


┌───────────────┐
│ User registers│
└───────┬───────┘
│
▼
┌───────────────────────────┐
│ Generate activation token │
│ (6-digit, expires in 15m)│
└───────────┬──────────────┘
│
▼
┌───────────────────────────┐
│ Save token in database    │
└───────────┬──────────────┘
│
▼
┌───────────────────────────┐
│ Send email with token/URL │
└───────────┬──────────────┘
│
▼
┌───────────────────────────┐
│ User clicks activation link│
└───────────┬──────────────┘
│
▼
┌───────────────────────────┐
│ Retrieve token from DB     │
└───────────┬──────────────┘
│
▼
┌─────────────────────────┐
│ Is token valid & active?│
└───────┬─────────┬──────┘
│         │
Yes         No
│         │
▼         ▼
┌─────────────────────────┐   ┌───────────────────────────────┐
│ Activate user account   │   │ Token expired or invalid       │
│ setEnabled(true)        │   │ Generate new token             │
│ Mark token validated    │   │ Send new validation email      │
└───────────┬────────────┘   └───────────────────────────────┘
│
▼
┌───────────────────────────┐
│ User account activated     │
│ Can now login              │
└───────────────────────────┘
